<html>
    <head>
        <!-- Library stylesheets -->
        <link rel="stylesheet" href="css/pure-min.css" />
        <!-- Library stylesheets -->
        <link rel="stylesheet" href="css/app.css" />
        <script type="text/javascript" src="js/jquery-3.6.0.js"></script>
        <title> WebSockets tester </title>
    </head>
    <body>
        <div id="app_header">
            <h2 class="main_header_title"> WebSockets test utility. </h2>
        </div>
        <hr/>
        <div id="app_center">
            <div class="pure-g" style="height: 100%">
                <div class="pure-u-3-5">
                    <div class="app_center_ws_config">
                       <h4 class="header_title"> WebSockets control interface</h4>
                       <form class="pure-form pure-form-aligned">
                           <fieldset style="padding-left: 10px">
                               <div class="pure-control-group">
                                   <label class="pure-u-1-3" for="ws_address">Server address: </label>
                                   <input type="text" id="ws_address" class="pure-u-2-3" placeholder="i.e. ws://127.0.0.1:8080/chat" />
                               </div>
                               <div class="pure-control-group">
                                   <label class="pure-u-1-3" for="ws_payload">Payload: </label>
                                   <textarea id="ws_payload" class="pure-u-2-3 payload_area" placeholder="payload (json or other)"></textarea>
                                   <br/> <br/>
                                   <label class="pure-u-1-3"></label>
                                   <div class="pure-u-2-3">
                                       <button type="button" class="pure-button btn_open" onclick="openWsServer()">Open</button>
                                       <button type="button" class="pure-button btn_close" onclick="closeWsServer()">Close</button>
                                       <button type="button" id="ws_send" 
                                               class="pure-button pure-button-primary" onclick="sendDataToWsServer()">Send</button>
                                   </div>
                               </div>
                           </fieldset>
                       </form>
                    </div>
                </div>
                <div class="pure-u-2-5">
                    <div class="app_center_ws_logs">
                        <h4 class="header_title"> WebSockets interaction logs</h4>
                           <form class="pure-form pure-form-aligned">
                               <fieldset style="padding-left: 10px">
                                   <label for="ws_logs">Logs: </label>
                                   <textarea readonly id="ws_logs" class="logs_area" placeholder="logs will be displayed here"></textarea>
                               </fieldset>
                           </form>
                    </div>
                </div>
            </div>
        </div>
        <hr/>
        <div id="app_footer">
            <h6 class="footer_title">This software was developed by <a href="https://wissance.com">Wissance LLC</a>, 2019-2021+ </h6>
            <h6 class="footer_title"> Please support our work <a href="https://github.com/Wissance/wstester"> rise a star on github</a>! and/or subscribe to our media:  </h6>
        </div>
        <script type="text/javascript">

            var socketAddress = "";
            var socket = null;

            function openWsServer() {
                var address = $("#ws_address").val();
                socketAddress = address;
                console.log("Websocket open server: " + address);
                socket = new WebSocket(socketAddress)
                // todo: analyze was socket conn establish was successful or not
                // todo: UMV: log to logs textarea
                socket.onmessage = function (event) {
                    console.log("Got message from server");
                    // todo: UMV: log to logs textarea
                }
            }

            function closeWsServer() {
                console.log("Websocket close server");
                if (socket != null) {
                    socket.close();
                    socket = null;
                    // todo: UMV: log to logs textarea
                }
            }

            function sendDataToWsServer() {
                if (socket != null) {
                    console.log("Websocket send data");
                    var message = $("#ws_payload").val();
                    if (message.startsWith("{")
                        message = JSON.stringify(message);
                    socket.send(message);
                    // todo: UMV: add log to logs textarea here
                }
            }

            function buildServerAddress(address) {
            }

            function logWsEvent(messageType, messageData) {
                var logMsg = createLogMessage(messageType, messageData);
                $("#ws_logs").append(logMsg);
            }

            function createLogMessage(messageType, messageData) {
                var dateStr = getFormattedDate();
                var logStr = dateStr + ": " + messageType;
                if (messageData != null && messageData.length > 0) {
                    logStr = logStr + " : " + messageData
                }
                return messageData;
            }

            function getFormattedDate() {
                var date = new Date();
                var str = date.getFullYear() + "-" + (date.getMonth() + 1) + "-" + date.getDate() + " " +  date.getHours() + ":" + date.getMinutes() + ":" + date.getSeconds();

                return str;
            }

        </script>
    </body>
</html>